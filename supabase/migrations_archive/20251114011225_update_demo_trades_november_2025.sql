/*
  # Update Demo Trades to November 2025

  1. Summary
    This migration updates all demo datasets (A, B, C) with new trades dated November 2025.
    Dataset A shows large profits, Dataset B shows balanced results, and Dataset C shows large losses.

  2. Changes
    - Deletes all existing demo trades (datasets A, B, C)
    - Inserts new November 2025 trades for each dataset
    - Dataset A: 13 trades, Total P&L: +435,050
    - Dataset B: 13 trades, Total P&L: +22,750
    - Dataset C: 13 trades, Total P&L: -363,250

  3. Important Notes
    - Only affects demo datasets (A, B, C)
    - User uploaded data is not affected
    - All trades are dated in November 2025
*/

DO $$
DECLARE
  user_record RECORD;
BEGIN
  FOR user_record IN SELECT id FROM auth.users LOOP
    DELETE FROM trades
    WHERE user_id = user_record.id
    AND dataset IN ('A', 'B', 'C');

    INSERT INTO trades (user_id, dataset, ticket, item, side, size, open_time, open_price, close_time, close_price, sl, tp, commission, swap, profit, pips)
    VALUES
      (user_record.id, 'A', '101000500', 'EURUSD', 'buy', 2.0, '2025-11-01 08:00:00+00', 1.0745, '2025-11-01 16:30:00+00', 1.087, 1.0695, 1.087, -12.0, 3.2, 25000, 125.0),
      (user_record.id, 'A', '101000501', 'GBPUSD', 'sell', 1.5, '2025-11-04 09:15:00+00', 1.292, '2025-11-04 17:45:00+00', 1.278, 1.297, 1.273, -12.0, 2.8, 21000, 140.0),
      (user_record.id, 'A', '101000502', 'USDJPY', 'buy', 3.0, '2025-11-06 10:30:00+00', 149.5, '2025-11-06 18:00:00+00', 150.8, 149.0, 151.0, -12.0, 4.5, 39000, 130.0),
      (user_record.id, 'A', '101000503', 'AUDUSD', 'buy', 2.0, '2025-11-08 07:45:00+00', 0.6545, '2025-11-08 15:20:00+00', 0.6695, 0.6495, 0.6745, -12.0, 3.6, 30000, 150.0),
      (user_record.id, 'A', '101000504', 'EURJPY', 'sell', 2.5, '2025-11-11 11:00:00+00', 164.5, '2025-11-11 19:30:00+00', 162.8, 165.0, 162.5, -12.0, 3.1, 42500, 170.0),
      (user_record.id, 'A', '101000505', 'GBPJPY', 'buy', 1.8, '2025-11-13 08:30:00+00', 194.5, '2025-11-13 16:45:00+00', 196.8, 193.5, 197.0, -12.0, 2.9, 41400, 230.0),
      (user_record.id, 'A', '101000506', 'EURUSD', 'buy', 2.2, '2025-11-15 09:20:00+00', 1.0745, '2025-11-15 17:50:00+00', 1.0885, 1.0695, 1.089, -12.0, 3.8, 30800, 140.0),
      (user_record.id, 'A', '101000507', 'USDJPY', 'buy', 2.8, '2025-11-18 10:15:00+00', 149.2, '2025-11-18 18:40:00+00', 150.95, 148.7, 151.2, -12.0, 4.2, 49000, 175.0),
      (user_record.id, 'A', '101000508', 'GBPUSD', 'sell', 1.6, '2025-11-20 11:30:00+00', 1.2915, '2025-11-20 19:00:00+00', 1.274, 1.2965, 1.2715, -12.0, 3.3, 28000, 175.0),
      (user_record.id, 'A', '101000509', 'AUDUSD', 'sell', 1.9, '2025-11-22 08:45:00+00', 0.6695, '2025-11-22 16:20:00+00', 0.655, 0.6745, 0.6545, -12.0, 3.5, 27550, 145.0),
      (user_record.id, 'A', '101000510', 'EURJPY', 'buy', 2.3, '2025-11-25 09:50:00+00', 162.3, '2025-11-25 17:15:00+00', 164.4, 161.8, 164.8, -12.0, 3.7, 48300, 210.0),
      (user_record.id, 'A', '101000511', 'USDJPY', 'sell', 2.1, '2025-11-27 10:20:00+00', 151.2, '2025-11-27 18:45:00+00', 149.7, 151.7, 149.2, -12.0, 4.1, 31500, 150.0),
      (user_record.id, 'A', '101000512', 'GBPUSD', 'buy', 1.4, '2025-11-29 11:15:00+00', 1.273, '2025-11-29 19:30:00+00', 1.288, 1.268, 1.2905, -12.0, 3.4, 21000, 150.0),

      (user_record.id, 'B', '101000600', 'EURUSD', 'buy', 1.2, '2025-11-02 09:30:00+00', 1.079, '2025-11-02 17:00:00+00', 1.082, 1.074, 1.084, -12.0, 2.1, 3600, 30.0),
      (user_record.id, 'B', '101000601', 'GBPUSD', 'sell', 0.8, '2025-11-05 10:45:00+00', 1.285, '2025-11-05 18:20:00+00', 1.282, 1.29, 1.277, -12.0, 1.5, 2400, 30.0),
      (user_record.id, 'B', '101000602', 'USDJPY', 'buy', 1.5, '2025-11-07 08:15:00+00', 150.1, '2025-11-07 16:45:00+00', 150.05, 149.6, 150.6, -12.0, 2.8, -750, -5.0),
      (user_record.id, 'B', '101000603', 'AUDUSD', 'sell', 1.0, '2025-11-10 11:20:00+00', 0.662, '2025-11-10 19:50:00+00', 0.664, 0.667, 0.657, -12.0, 1.9, -2000, -20.0),
      (user_record.id, 'B', '101000604', 'EURJPY', 'buy', 1.3, '2025-11-12 09:00:00+00', 163.4, '2025-11-12 17:30:00+00', 163.8, 162.9, 164.4, -12.0, 2.3, 5200, 40.0),
      (user_record.id, 'B', '101000605', 'GBPJPY', 'sell', 0.9, '2025-11-14 10:15:00+00', 195.6, '2025-11-14 18:40:00+00', 195.2, 196.1, 194.6, -12.0, 1.7, 3600, 40.0),
      (user_record.id, 'B', '101000606', 'EURUSD', 'sell', 1.1, '2025-11-17 08:30:00+00', 1.081, '2025-11-17 16:00:00+00', 1.083, 1.086, 1.076, -12.0, 2.0, -2200, -20.0),
      (user_record.id, 'B', '101000607', 'USDJPY', 'sell', 1.4, '2025-11-19 11:40:00+00', 150.4, '2025-11-19 19:10:00+00', 150.1, 150.9, 149.9, -12.0, 2.5, 4200, 30.0),
      (user_record.id, 'B', '101000608', 'GBPUSD', 'buy', 0.7, '2025-11-21 09:50:00+00', 1.276, '2025-11-21 17:20:00+00', 1.279, 1.271, 1.286, -12.0, 1.3, 2100, 30.0),
      (user_record.id, 'B', '101000609', 'AUDUSD', 'buy', 1.2, '2025-11-24 10:30:00+00', 0.6585, '2025-11-24 18:00:00+00', 0.6605, 0.6535, 0.6635, -12.0, 2.2, 2400, 20.0),
      (user_record.id, 'B', '101000610', 'EURJPY', 'sell', 1.0, '2025-11-26 08:45:00+00', 163.7, '2025-11-26 16:15:00+00', 163.5, 164.2, 163.2, -12.0, 1.8, 2000, 20.0),
      (user_record.id, 'B', '101000611', 'USDJPY', 'buy', 0.8, '2025-11-28 09:20:00+00', 150.3, '2025-11-28 11:30:00+00', 150.5, 149.8, 150.8, -12.0, 1.4, 1600, 20.0),
      (user_record.id, 'B', '101000612', 'GBPUSD', 'sell', 0.6, '2025-11-29 14:10:00+00', 1.2815, '2025-11-29 16:20:00+00', 1.2805, 1.2865, 1.2765, -12.0, 1.1, 600, 10.0),

      (user_record.id, 'C', '101000700', 'EURUSD', 'buy', 2.0, '2025-11-03 08:15:00+00', 1.0845, '2025-11-03 15:30:00+00', 1.072, 1.0795, 1.0895, -12.0, -5.2, -25000, -125.0),
      (user_record.id, 'C', '101000701', 'GBPUSD', 'sell', 1.5, '2025-11-05 10:20:00+00', 1.278, '2025-11-05 18:45:00+00', 1.292, 1.273, 1.293, -12.0, -3.8, -21000, -140.0),
      (user_record.id, 'C', '101000702', 'USDJPY', 'buy', 3.0, '2025-11-07 06:30:00+00', 150.8, '2025-11-07 12:15:00+00', 149.5, 150.3, 151.3, -12.0, -7.5, -39000, -130.0),
      (user_record.id, 'C', '101000703', 'AUDUSD', 'sell', 2.0, '2025-11-10 14:00:00+00', 0.6545, '2025-11-10 20:30:00+00', 0.6695, 0.6495, 0.6745, -12.0, -4.3, -30000, -150.0),
      (user_record.id, 'C', '101000704', 'EURJPY', 'buy', 2.5, '2025-11-12 09:45:00+00', 164.5, '2025-11-12 16:20:00+00', 162.8, 164.0, 165.0, -12.0, -6.1, -42500, -170.0),
      (user_record.id, 'C', '101000705', 'GBPJPY', 'sell', 1.8, '2025-11-14 11:30:00+00', 194.5, '2025-11-14 19:00:00+00', 196.8, 193.5, 197.0, -12.0, -5.5, -41400, -230.0),
      (user_record.id, 'C', '101000706', 'EURUSD', 'sell', 2.2, '2025-11-17 07:15:00+00', 1.0745, '2025-11-17 14:45:00+00', 1.0885, 1.0695, 1.089, -12.0, -4.7, -30800, -140.0),
      (user_record.id, 'C', '101000707', 'USDJPY', 'sell', 2.8, '2025-11-19 13:20:00+00', 149.2, '2025-11-19 19:50:00+00', 150.95, 148.7, 151.2, -12.0, -6.8, -49000, -175.0),
      (user_record.id, 'C', '101000708', 'GBPUSD', 'buy', 1.6, '2025-11-21 08:40:00+00', 1.274, '2025-11-21 15:10:00+00', 1.262, 1.269, 1.279, -12.0, -3.9, -19200, -120.0),
      (user_record.id, 'C', '101000709', 'AUDUSD', 'buy', 1.9, '2025-11-24 10:15:00+00', 0.6695, '2025-11-24 17:30:00+00', 0.655, 0.6645, 0.6745, -12.0, -4.5, -27550, -145.0),
      (user_record.id, 'C', '101000710', 'EURJPY', 'sell', 2.3, '2025-11-26 12:00:00+00', 162.3, '2025-11-26 18:25:00+00', 164.4, 161.8, 164.8, -12.0, -5.8, -48300, -210.0),
      (user_record.id, 'C', '101000711', 'USDJPY', 'buy', 2.1, '2025-11-28 09:30:00+00', 149.7, '2025-11-28 11:45:00+00', 149.2, 149.2, 150.2, -12.0, -1.8, -10500, -50.0),
      (user_record.id, 'C', '101000712', 'GBPUSD', 'sell', 1.4, '2025-11-29 14:20:00+00', 1.288, '2025-11-29 16:40:00+00', 1.273, 1.293, 1.268, -12.0, -1.2, 21000, 150.0)
    ON CONFLICT (user_id, dataset, ticket) DO UPDATE SET
      item = EXCLUDED.item,
      side = EXCLUDED.side,
      size = EXCLUDED.size,
      open_time = EXCLUDED.open_time,
      open_price = EXCLUDED.open_price,
      close_time = EXCLUDED.close_time,
      close_price = EXCLUDED.close_price,
      sl = EXCLUDED.sl,
      tp = EXCLUDED.tp,
      commission = EXCLUDED.commission,
      swap = EXCLUDED.swap,
      profit = EXCLUDED.profit,
      pips = EXCLUDED.pips;
  END LOOP;
END $$;
