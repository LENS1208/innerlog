/*
  # データベースの簡素化とクリーンなデモデータ挿入

  1. 目的
    - RLSを一時的に無効化してデモデータを挿入
    - 複雑すぎるテーブル構造を簡素化
    
  2. 変更内容
    - tradesテーブル: RLS一時無効化でデータ挿入
    - 新しいリアルなデモデータセット（November 2025）
    
  3. セキュリティ
    - データ挿入後にRLSを再有効化
*/

-- RLSを一時的に無効化
ALTER TABLE trades DISABLE ROW LEVEL SECURITY;
ALTER TABLE account_summary DISABLE ROW LEVEL SECURITY;
ALTER TABLE account_transactions DISABLE ROW LEVEL SECURITY;

-- 既存のデモデータを削除
DELETE FROM trades WHERE user_id = 'cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2';
DELETE FROM account_summary WHERE user_id = 'cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2';
DELETE FROM account_transactions WHERE user_id = 'cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2';

-- November 2025のリアルなデモデータ（60取引）
INSERT INTO trades (user_id, ticket, item, side, size, open_time, open_price, close_time, close_price, sl, tp, commission, swap, profit, pips, dataset, setup) VALUES
-- Week 1: Nov 1-7 (15 trades, mixed performance)
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1101001', 'USDJPY', 'buy', 1.0, '2025-11-03 08:00:00+00', 149.50, '2025-11-03 14:30:00+00', 150.20, 149.00, 150.50, -10, 1.2, 70000, 70.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1101002', 'EURUSD', 'sell', 1.5, '2025-11-03 10:15:00+00', 1.0850, '2025-11-03 15:45:00+00', 1.0820, 1.0880, 1.0800, -12, 1.8, 45000, 30.0, 'default', 'レンジ逆張り'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1101003', 'GBPJPY', 'buy', 0.8, '2025-11-04 09:00:00+00', 193.20, '2025-11-04 13:30:00+00', 193.80, 192.80, 194.00, -10, 1.5, 48000, 60.0, 'default', 'ブレイクアウト'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1101004', 'AUDUSD', 'sell', 1.0, '2025-11-04 11:30:00+00', 0.6580, '2025-11-04 16:00:00+00', 0.6620, 0.6550, 0.6650, -10, 0.8, -40000, -40.0, 'default', 'レンジ逆張り'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1101005', 'USDJPY', 'sell', 1.2, '2025-11-05 08:30:00+00', 150.80, '2025-11-05 14:00:00+00', 150.10, 151.20, 149.90, -12, 1.5, 84000, 70.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1101006', 'EURUSD', 'buy', 1.5, '2025-11-05 10:00:00+00', 1.0780, '2025-11-05 15:30:00+00', 1.0840, 1.0750, 1.0860, -12, 2.0, 90000, 60.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1101007', 'GBPUSD', 'sell', 1.0, '2025-11-06 09:15:00+00', 1.2680, '2025-11-06 13:45:00+00', 1.2720, 1.2650, 1.2750, -10, 1.2, -40000, -40.0, 'default', 'レンジ逆張り'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1101008', 'USDJPY', 'buy', 1.0, '2025-11-06 11:00:00+00', 149.90, '2025-11-06 16:30:00+00', 150.50, 149.50, 151.00, -10, 1.8, 60000, 60.0, 'default', 'ブレイクアウト'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1101009', 'EURJPY', 'buy', 0.9, '2025-11-07 08:45:00+00', 161.50, '2025-11-07 13:15:00+00', 162.20, 161.00, 162.50, -10, 1.5, 63000, 70.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1101010', 'AUDUSD', 'buy', 1.2, '2025-11-07 10:30:00+00', 0.6540, '2025-11-07 15:00:00+00', 0.6580, 0.6510, 0.6600, -12, 0.9, 48000, 40.0, 'default', 'ブレイクアウト'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1101011', 'USDJPY', 'sell', 1.0, '2025-11-07 12:00:00+00', 151.20, '2025-11-07 16:30:00+00', 150.60, 151.60, 150.40, -10, 2.0, 60000, 60.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1101012', 'EURUSD', 'sell', 1.5, '2025-11-07 14:15:00+00', 1.0880, '2025-11-07 17:45:00+00', 1.0920, 1.0850, 1.0950, -12, 1.8, -60000, -40.0, 'default', 'レンジ逆張り'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1101013', 'GBPJPY', 'sell', 0.8, '2025-11-07 15:30:00+00', 194.50, '2025-11-07 18:00:00+00', 193.90, 194.90, 193.70, -10, 1.2, 48000, 60.0, 'default', 'ブレイクアウト'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1101014', 'AUDUSD', 'sell', 1.0, '2025-11-07 16:00:00+00', 0.6600, '2025-11-07 19:30:00+00', 0.6550, 0.6630, 0.6530, -10, 1.0, 50000, 50.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1101015', 'USDJPY', 'buy', 1.2, '2025-11-07 17:00:00+00', 150.30, '2025-11-07 20:30:00+00', 150.90, 149.90, 151.20, -12, 1.5, 72000, 60.0, 'default', 'ブレイクアウト'),

-- Week 2: Nov 10-14 (15 trades, improving performance)
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1102001', 'USDJPY', 'buy', 1.0, '2025-11-10 08:00:00+00', 150.80, '2025-11-10 14:00:00+00', 151.50, 150.30, 152.00, -10, 1.5, 70000, 70.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1102002', 'EURUSD', 'sell', 1.5, '2025-11-10 10:00:00+00', 1.0820, '2025-11-10 15:30:00+00', 1.0790, 1.0850, 1.0770, -12, 1.8, 45000, 30.0, 'default', 'レンジ逆張り'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1102003', 'GBPJPY', 'buy', 0.9, '2025-11-11 09:00:00+00', 194.80, '2025-11-11 13:30:00+00', 195.50, 194.30, 195.80, -10, 1.5, 63000, 70.0, 'default', 'ブレイクアウト'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1102004', 'AUDUSD', 'buy', 1.0, '2025-11-11 11:00:00+00', 0.6570, '2025-11-11 16:00:00+00', 0.6610, 0.6540, 0.6630, -10, 1.0, 40000, 40.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1102005', 'USDJPY', 'sell', 1.2, '2025-11-12 08:30:00+00', 152.00, '2025-11-12 14:00:00+00', 151.30, 152.40, 151.10, -12, 1.8, 84000, 70.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1102006', 'EURUSD', 'buy', 1.5, '2025-11-12 10:15:00+00', 1.0760, '2025-11-12 15:45:00+00', 1.0820, 1.0730, 1.0840, -12, 2.0, 90000, 60.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1102007', 'EURJPY', 'sell', 0.8, '2025-11-13 09:00:00+00', 163.50, '2025-11-13 13:30:00+00', 162.90, 163.90, 162.70, -10, 1.5, 48000, 60.0, 'default', 'ブレイクアウト'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1102008', 'GBPUSD', 'buy', 1.0, '2025-11-13 11:00:00+00', 1.2650, '2025-11-13 16:00:00+00', 1.2610, 1.2620, 1.2690, -10, 1.2, -40000, -40.0, 'default', 'レンジ逆張り'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1102009', 'USDJPY', 'buy', 1.0, '2025-11-14 08:00:00+00', 151.20, '2025-11-14 14:00:00+00', 151.90, 150.70, 152.20, -10, 1.5, 70000, 70.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1102010', 'AUDUSD', 'sell', 1.2, '2025-11-14 10:30:00+00', 0.6630, '2025-11-14 15:00:00+00', 0.6590, 0.6660, 0.6570, -12, 1.0, 48000, 40.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1102011', 'EURUSD', 'sell', 1.5, '2025-11-14 12:00:00+00', 1.0860, '2025-11-14 17:00:00+00', 1.0830, 1.0890, 1.0810, -12, 1.8, 45000, 30.0, 'default', 'レンジ逆張り'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1102012', 'GBPJPY', 'buy', 0.9, '2025-11-14 14:00:00+00', 195.20, '2025-11-14 18:00:00+00', 195.90, 194.70, 196.20, -10, 1.5, 63000, 70.0, 'default', 'ブレイクアウト'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1102013', 'USDJPY', 'sell', 1.0, '2025-11-14 16:00:00+00', 152.30, '2025-11-14 19:30:00+00', 151.70, 152.70, 151.50, -10, 1.5, 60000, 60.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1102014', 'EURJPY', 'buy', 0.8, '2025-11-14 17:00:00+00', 162.80, '2025-11-14 20:00:00+00', 163.50, 162.30, 163.80, -10, 1.2, 56000, 70.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1102015', 'AUDUSD', 'buy', 1.0, '2025-11-14 18:00:00+00', 0.6560, '2025-11-14 21:00:00+00', 0.6600, 0.6530, 0.6620, -10, 1.0, 40000, 40.0, 'default', 'ブレイクアウト'),

-- Week 3: Nov 17-21 (15 trades, strong performance)
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1103001', 'USDJPY', 'buy', 1.0, '2025-11-17 08:00:00+00', 152.00, '2025-11-17 14:00:00+00', 152.70, 151.50, 153.00, -10, 1.5, 70000, 70.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1103002', 'EURUSD', 'sell', 1.5, '2025-11-17 10:00:00+00', 1.0840, '2025-11-17 15:30:00+00', 1.0810, 1.0870, 1.0790, -12, 1.8, 45000, 30.0, 'default', 'レンジ逆張り'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1103003', 'GBPJPY', 'buy', 0.9, '2025-11-18 09:00:00+00', 196.00, '2025-11-18 13:30:00+00', 196.70, 195.50, 197.00, -10, 1.5, 63000, 70.0, 'default', 'ブレイクアウト'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1103004', 'AUDUSD', 'buy', 1.0, '2025-11-18 11:00:00+00', 0.6590, '2025-11-18 16:00:00+00', 0.6630, 0.6560, 0.6650, -10, 1.0, 40000, 40.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1103005', 'USDJPY', 'sell', 1.2, '2025-11-19 08:30:00+00', 153.20, '2025-11-19 14:00:00+00', 152.50, 153.60, 152.30, -12, 1.8, 84000, 70.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1103006', 'EURUSD', 'buy', 1.5, '2025-11-19 10:15:00+00', 1.0780, '2025-11-19 15:45:00+00', 1.0840, 1.0750, 1.0860, -12, 2.0, 90000, 60.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1103007', 'EURJPY', 'sell', 0.8, '2025-11-20 09:00:00+00', 164.50, '2025-11-20 13:30:00+00', 163.90, 164.90, 163.70, -10, 1.5, 48000, 60.0, 'default', 'ブレイクアウト'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1103008', 'GBPUSD', 'buy', 1.0, '2025-11-20 11:00:00+00', 1.2680, '2025-11-20 16:00:00+00', 1.2720, 1.2650, 1.2740, -10, 1.2, 40000, 40.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1103009', 'USDJPY', 'buy', 1.0, '2025-11-21 08:00:00+00', 152.50, '2025-11-21 14:00:00+00', 153.20, 152.00, 153.50, -10, 1.5, 70000, 70.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1103010', 'AUDUSD', 'sell', 1.2, '2025-11-21 10:30:00+00', 0.6650, '2025-11-21 15:00:00+00', 0.6610, 0.6680, 0.6590, -12, 1.0, 48000, 40.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1103011', 'EURUSD', 'sell', 1.5, '2025-11-21 12:00:00+00', 1.0880, '2025-11-21 17:00:00+00', 1.0850, 1.0910, 1.0830, -12, 1.8, 45000, 30.0, 'default', 'レンジ逆張り'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1103012', 'GBPJPY', 'buy', 0.9, '2025-11-21 14:00:00+00', 196.50, '2025-11-21 18:00:00+00', 197.20, 196.00, 197.50, -10, 1.5, 63000, 70.0, 'default', 'ブレイクアウト'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1103013', 'USDJPY', 'sell', 1.0, '2025-11-21 16:00:00+00', 153.50, '2025-11-21 19:30:00+00', 152.90, 153.90, 152.70, -10, 1.5, 60000, 60.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1103014', 'EURJPY', 'buy', 0.8, '2025-11-21 17:00:00+00', 163.80, '2025-11-21 20:00:00+00', 164.50, 163.30, 164.80, -10, 1.2, 56000, 70.0, 'default', 'トレンドフォロー'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1103015', 'AUDUSD', 'buy', 1.0, '2025-11-21 18:00:00+00', 0.6580, '2025-11-21 21:00:00+00', 0.6620, 0.6550, 0.6640, -10, 1.0, 40000, 40.0, 'default', 'ブレイクアウト'),

-- Additional 15 trades to make 60 total
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1104001', 'USDJPY', 'buy', 1.0, '2025-11-03 20:00:00+00', 149.80, '2025-11-04 02:00:00+00', 150.40, 149.30, 150.80, -10, 1.5, 60000, 60.0, 'default', 'アジア時間'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1104002', 'EURUSD', 'sell', 1.5, '2025-11-04 20:30:00+00', 1.0860, '2025-11-05 01:30:00+00', 1.0830, 1.0890, 1.0810, -12, 1.8, 45000, 30.0, 'default', 'アジア時間'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1104003', 'GBPJPY', 'buy', 0.9, '2025-11-05 21:00:00+00', 193.50, '2025-11-06 03:00:00+00', 194.20, 193.00, 194.50, -10, 1.5, 63000, 70.0, 'default', 'アジア時間'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1104004', 'AUDUSD', 'buy', 1.0, '2025-11-06 20:00:00+00', 0.6560, '2025-11-07 02:00:00+00', 0.6600, 0.6530, 0.6620, -10, 1.0, 40000, 40.0, 'default', 'アジア時間'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1104005', 'USDJPY', 'sell', 1.2, '2025-11-10 21:00:00+00', 151.50, '2025-11-11 03:00:00+00', 150.80, 151.90, 150.60, -12, 1.8, 84000, 70.0, 'default', 'アジア時間'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1104006', 'EURUSD', 'buy', 1.5, '2025-11-11 20:30:00+00', 1.0800, '2025-11-12 01:30:00+00', 1.0860, 1.0770, 1.0880, -12, 2.0, 90000, 60.0, 'default', 'アジア時間'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1104007', 'EURJPY', 'sell', 0.8, '2025-11-12 21:00:00+00', 163.20, '2025-11-13 03:00:00+00', 162.60, 163.60, 162.40, -10, 1.5, 48000, 60.0, 'default', 'アジア時間'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1104008', 'GBPUSD', 'buy', 1.0, '2025-11-13 20:00:00+00', 1.2670, '2025-11-14 02:00:00+00', 1.2710, 1.2640, 1.2730, -10, 1.2, 40000, 40.0, 'default', 'アジア時間'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1104009', 'USDJPY', 'buy', 1.0, '2025-11-17 21:00:00+00', 152.30, '2025-11-18 03:00:00+00', 152.90, 151.80, 153.30, -10, 1.5, 60000, 60.0, 'default', 'アジア時間'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1104010', 'AUDUSD', 'sell', 1.2, '2025-11-18 20:30:00+00', 0.6640, '2025-11-19 02:30:00+00', 0.6600, 0.6670, 0.6580, -12, 1.0, 48000, 40.0, 'default', 'アジア時間'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1104011', 'EURUSD', 'sell', 1.5, '2025-11-19 21:00:00+00', 1.0870, '2025-11-20 03:00:00+00', 1.0840, 1.0900, 1.0820, -12, 1.8, 45000, 30.0, 'default', 'アジア時間'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1104012', 'GBPJPY', 'buy', 0.9, '2025-11-20 20:00:00+00', 196.30, '2025-11-21 02:00:00+00', 197.00, 195.80, 197.30, -10, 1.5, 63000, 70.0, 'default', 'アジア時間'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1104013', 'USDJPY', 'sell', 1.0, '2025-11-07 22:00:00+00', 151.80, '2025-11-08 04:00:00+00', 151.20, 152.20, 151.00, -10, 1.5, 60000, 60.0, 'default', 'アジア時間'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1104014', 'EURJPY', 'buy', 0.8, '2025-11-14 21:30:00+00', 163.00, '2025-11-15 03:30:00+00', 163.70, 162.50, 164.00, -10, 1.2, 56000, 70.0, 'default', 'アジア時間'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '1104015', 'AUDUSD', 'buy', 1.0, '2025-11-21 22:00:00+00', 0.6600, '2025-11-22 04:00:00+00', 0.6640, 0.6570, 0.6660, -10, 1.0, 40000, 40.0, 'default', 'アジア時間');

-- アカウントサマリー挿入
INSERT INTO account_summary (user_id, balance, equity, profit, deposit, withdraw, commission, swap, swap_long, swap_short, dataset)
VALUES ('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', 3500000, 3500000, 2500000, 1000000, 0, -600, 85, 45, 40, 'default')
ON CONFLICT (user_id, dataset) DO UPDATE SET
  balance = EXCLUDED.balance,
  equity = EXCLUDED.equity,
  profit = EXCLUDED.profit,
  deposit = EXCLUDED.deposit,
  withdraw = EXCLUDED.withdraw,
  commission = EXCLUDED.commission,
  swap = EXCLUDED.swap,
  swap_long = EXCLUDED.swap_long,
  swap_short = EXCLUDED.swap_short,
  updated_at = NOW();

-- アカウント取引履歴挿入
INSERT INTO account_transactions (user_id, time, transaction_date, type, transaction_type, amount, balance, comment, dataset) VALUES
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '2025-11-01 00:00:00+00', '2025-11-01 00:00:00+00', 'deposit', 'deposit', 1000000, 1000000, '初期入金', 'default'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '2025-11-07 23:59:59+00', '2025-11-07 23:59:59+00', 'credit', 'credit', 750000, 1750000, 'Week 1の利益', 'default'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '2025-11-14 23:59:59+00', '2025-11-14 23:59:59+00', 'credit', 'credit', 850000, 2600000, 'Week 2の利益', 'default'),
('cbcc1f55-2f10-41a5-96c4-c2d316ab1fd2', '2025-11-21 23:59:59+00', '2025-11-21 23:59:59+00', 'credit', 'credit', 900000, 3500000, 'Week 3の利益', 'default');

-- RLSを再有効化
ALTER TABLE trades ENABLE ROW LEVEL SECURITY;
ALTER TABLE account_summary ENABLE ROW LEVEL SECURITY;
ALTER TABLE account_transactions ENABLE ROW LEVEL SECURITY;