/*
  # Fix Critical RLS Security Vulnerability

  1. Problem
    - All tables have dangerous "Allow all access" policies with USING (true)
    - This allows ANY user to access OTHER users' data
    - CRITICAL SECURITY ISSUE

  2. Changes
    - Drop all insecure "Allow all access" policies
    - Keep only the proper user-specific policies that were added later

  3. Security
    - After this migration, users can ONLY access their own data
    - Demo data (user_id IS NULL) remains accessible to authenticated users
*/

-- Drop all dangerous "USING (true)" policies
DROP POLICY IF EXISTS "Allow all access to trades" ON trades;
DROP POLICY IF EXISTS "Allow all access to trade_notes" ON trade_notes;
DROP POLICY IF EXISTS "Allow all access to daily_notes" ON daily_notes;
DROP POLICY IF EXISTS "Allow all access to free_memos" ON free_memos;
DROP POLICY IF EXISTS "Allow all access to note_links" ON note_links;

-- Verify the remaining policies are correct
-- The following policies should remain:
-- trades: "Users can view own trades and demo data" (SELECT)
-- trades: "Users can insert own trades" (INSERT)
-- trades: "Users can update own trades" (UPDATE)
-- trades: "Users can delete own trades" (DELETE)
-- Similar policies exist for other tables
