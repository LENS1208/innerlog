# ダークモード改善状況レポート

## 完了した作業

### 1. CSS変数の追加（tokens.css）

✅ 入力フォーム用の新しい変数を追加：
- `--input-bg`: 入力フォームの背景色
- `--input-border`: ボーダー色
- `--input-border-focus`: フォーカス時のボーダー色
- `--input-text`: テキスト色
- `--input-placeholder`: プレースホルダー色

✅ ボタン用の新しい変数を追加：
- `--button-primary-bg/hover/text`: プライマリボタン
- `--button-secondary-bg/hover/text/border`: セカンダリボタン
- `--button-disabled-bg/text`: 無効化ボタン

**ライトモード:**
- 入力背景: `#ffffff`
- 入力ボーダー: `#e2e8f0`
- 入力テキスト: `#1a202c`

**ダークモード（新規）:**
- 入力背景: `#1f2937` （ダークグレー）
- 入力ボーダー: `#374151` （ミディアムグレー）
- 入力テキスト: `#e4e8f0` （ライトグレー）

### 2. 修正したファイル

#### tokens.css
- ✅ ライトモード・ダークモード両方に新しい変数を追加

#### FiltersBar.tsx
- ✅ `box`スタイルをCSS変数に置き換え

#### LoginPage.tsx
- ✅ 全38箇所のハードコードされた色をCSS変数に置き換え
- ✅ 入力フィールド、ボタン、ラベル、すべてダークモード対応

#### App.css
- ✅ `.kpi-card` をCSS変数に置き換え
- ✅ `.kpi-title` をCSS変数に置き換え
- ✅ `.kpi-unit` をCSS変数に置き換え
- ✅ `.kpi-desc` をCSS変数に置き換え
- ✅ `.info` をCSS変数に置き換え
- ✅ `.trade-row:hover` をCSS変数に置き換え
- ✅ `.fh-card` をCSS変数に置き換え
- ✅ `.fh-input` をCSS変数に置き換え
- ✅ `.fh-btn` をCSS変数に置き換え
- ✅ `.fh-badge` をCSS変数に置き換え

#### index.css
- ✅ `:root`の`--c-*`変数をCSS変数にマッピング
- ✅ 重複した`.info`定義を削除

---

## 残っている問題

### 主要な問題

**index.css に大量のハードコードされた色が残っている**

1. **`.fh-*`クラス群**（約50箇所）
   - `.fh-card`、`.fh-input`、`.fh-btn`などに`#fff`、`#e5e7eb`などがハードコード
   - 一部は修正済み（App.css）だが、index.cssにも重複定義あり

2. **`.fh-composer`系**（約10箇所）
   - チャットコンポーザーの背景、ボーダーが`#f7f7f8`、`#e5e7eb`などハードコード

3. **`.fh-memo`、`.fh-rate`系**（約5箇所）
   - 評価ボタン、メモ入力などがハードコード

4. **`.kpi-*`クラス**
   - `App.css`では修正済み
   - `index.css`にも定義があり、一部ハードコードが残っている可能性

### 統一感が不足している理由

1. **重複したCSS定義**
   - 同じクラス名が`index.css`と`App.css`に存在
   - 片方だけ修正しても効果が限定的

2. **インラインスタイルの多用**
   - TSXファイル内のインラインスタイルが優先される
   - CSSファイルの修正だけでは不十分

3. **ダークモード用のオーバーライドが不完全**
   - `index.css`には`:root[data-theme="dark"]`のルールが一部あるが不完全
   - 多くのクラスでダークモード時のスタイルが未定義

---

## 推奨される次のステップ

### 優先度 高（すぐにやるべき）

1. **index.cssの`.fh-*`クラスを一括修正**
   ```css
   /* 現在 */
   .fh-input{ border:1px solid #e5e7eb; background:#fff; }

   /* 修正後 */
   .fh-input{ border:1px solid var(--input-border); background:var(--input-bg); color:var(--input-text); }
   ```

2. **重複したCSS定義を整理**
   - `App.css`と`index.css`の重複を確認
   - どちらか一方に統一（推奨：tokens.cssに統合）

3. **主要コンポーネントのインラインスタイルを修正**
   - `PromptBar.tsx`
   - `TradeIdeasTable.tsx`
   - `DiaryIndexPage.tsx`

### 優先度 中（近いうちにやるべき）

4. **ダークモード専用のオーバーライドを追加**
   ```css
   :root[data-theme="dark"] .fh-input {
     background: var(--input-bg);
     border-color: var(--input-border);
     color: var(--input-text);
   }
   ```

5. **CSS変数の命名を統一**
   - `--c-*` 系の変数を廃止
   - すべて`--*`形式に統一

### 優先度 低（余裕があれば）

6. **CSSファイルの統合**
   - `index.css`の900行を整理
   - 機能ごとにファイル分割
   - `lib/styles/` ディレクトリに移動

7. **コンポーネントライブラリの作成**
   - 共通のButton、Input、Selectコンポーネント
   - すべてCSS変数ベース

---

## 作業見積もり

| タスク | 所要時間 | 影響範囲 |
|--------|----------|----------|
| index.cssの`.fh-*`修正 | 30分 | 大（約50箇所） |
| 重複CSS整理 | 20分 | 中 |
| 主要TSXファイル修正 | 1時間 | 大（5ファイル） |
| ダークモードオーバーライド追加 | 30分 | 大 |
| **合計** | **約2.5時間** | - |

---

## テスト項目

修正後、以下を確認してください：

- [ ] ログインページがダークモードで視認可能
- [ ] 入力フォームがダークモードで視認可能
- [ ] ボタンがダークモードで視認可能
- [ ] KPIカードがダークモードで視認可能
- [ ] トレードリストがダークモードで視認可能
- [ ] フィルターバーがダークモードで視認可能
- [ ] ライトモードで既存の見た目が維持されている
- [ ] トランジション（切り替えアニメーション）が滑らか

---

## 現在の状態

- ✅ **基盤は完成**: CSS変数システムが整備された
- ⚠️ **適用が不完全**: 既存コードの大部分がまだハードコード
- 🔧 **次のアクション**: `index.css`の`.fh-*`クラスを一括修正

---

## まとめ

**良いニュース:**
- CSS変数のインフラは完璧に整備されました
- ライトモードには影響がありません
- 段階的に修正できる構造になっています

**課題:**
- `index.css`に大量のハードコードが残っている
- 重複したCSS定義により、修正の効果が限定的
- インラインスタイルが多く、CSSの変更が適用されにくい

**推奨アクション:**
明日すぐに`index.css`の`.fh-*`クラスを一括修正すれば、ダークモードの統一感が大幅に改善されます。
